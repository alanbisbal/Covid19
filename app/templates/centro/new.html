{% extends "layout.html" %} {% import "bootstrap/wtf.html" as wtf %} {% block
title %}Centros{% endblock %} {% block content %}

<div class="container col-md-8 col-sm-12" style="max-width: 40rem">
  <div class="card">
    <form
      action="{{ url_for('centro_create') }}"
      method="POST"
      enctype="multipart/form-data"
    >
      <div class="card-header bg-primary text-white">
        <h5>Crear centro:</h5>
      </div>
      <div class="card-body">
        <div class="form-group">
          {{ form.csrf_token }} {% if form.csrf_token.errors %}
          <div class="warning">You have submitted an invalid CSRF token</div>
          {% endif %} {{wtf.form_field(form.nombre)}}
          {{wtf.form_field(form.direccion)}} {{wtf.form_field(form.telefono)}}
          {{wtf.form_field(form.hora_inicio,type="Time")}}
          {{wtf.form_field(form.hora_fin,type="Time")}}
          {{wtf.form_field(form.municipio_id)}} {{wtf.form_field(form.web)}}
          {{wtf.form_field(form.email)}}
          {{form.protocolo.label(class="form-control-label")}}
          {{form.protocolo(accept=".pdf")}} {{wtf.form_field(form.tipo_centro)}}
          {{wtf.form_field(form.estado_id)}}
        </div>
        <p>Seleccione la ubicaci√≥n del centro</p>
        <div id="mapid" style="height: 300px"></div>
        {{wtf.form_field(form.longitud,hidden="true")}}
        {{wtf.form_field(form.latitud,hidden= "true")}}

        <div class="form-inline">
          <a href="{{ url_for('centro_index') }}" class="btn btn-primary my-1"
            >Volver</a
          >
          <div
            class="card-body d-flex justify-content-between align-items-center"
          ></div>
          <div class="col-auto my-1">
            {{form.submit(class="btn btn-lg btn-success")}}
          </div>
          <div>
            <button type="reset" class="btn btn-danger">Limpiar</button>
          </div>
        </div>
      </div>
    </form>


    <script type="text/javascript">
      var mymap = L.map('mapid').locate({ setView: true, maxZoom: 5, center:[-36.5635, -60.1076] });

      L.tileLayer(
        'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw',
        {
          id: 'mapbox.streets',
        }
      ).addTo(mymap);
      var layerGroup = L.layerGroup().addTo(mymap);



      mymap.on('click', function(e){
          layerGroup.clearLayers();
          lat = e.latlng.lat.toFixed(3);
          lng = e.latlng.lng.toFixed(3);
          L.marker(e.latlng).addTo(layerGroup);
          document.getElementById("latitud").value = lat.toString();
          document.getElementById("longitud").value = lng.toString();

     });


    </script>

  </div>
   <!-- let latLng = mymap.mouseEventToLatLng(e.originalEvent)-->
   <!--L.marker.setLatLng([latLng.lat, latLng.lng]) -->
  {% endblock %}
</div>
