{% extends "layout.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% block title %}Perfil{% endblock %}
{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="https://developers.google.com//maps/documentation/javascript/demos/demos.css">
  <style>#map { height: 100%; width: 100%; }</style>
{% endblock %}

{% block content %}
<div class="jumbotron jumbotron-fluid">
  <div class="container">
    <h1 class="display-4"> Centro</h1>
    <hr class="my-4">

    <p ><strong >Nombre:</strong> {{centro.nombre }}</p>
    <p ><strong >Direccion:</strong> {{centro.direccion }}</p>
    <p ><strong >Telefono:</strong> {{centro.telefono }}</p>
    <p ><strong >Hora de apertura:</strong> {{centro.hora_inicio }}</p>
    <p ><strong >Hora de cierre:</strong> {{centro.hora_fin }}</p>
    <p ><strong >Municipio:</strong> </p>
    <div id="app">
          <p v-for="municipio in municipios" v-if="{{centro.municipio_id}} == municipio.id">
            [[municipio.id]]  -  [[municipio.name]]  (Fase:  [[municipio.phase ]])
          </p>
     </div>
    <p ><strong >Sitio web:</strong> {{centro.web }}</p>
    <p ><strong >Email:</strong> {{centro.email }}</p>
    <p ><strong >Estado:</strong> {{centro.estado.nombre}}</p>
    <p ><strong >Protocolo:</strong> <a href="{{url_for('static', filename='uploads/'+centro.protocolo)}}">Protocolo</a></p>
    <p ><strong >Tipo de centro:</strong> {{centro.tipo.nombre }}</p>
    <p ><strong >Latitud:</strong> {{centro.latitud }}</p>
    <p ><strong >Longitud:</strong> {{centro.longitud }}</p>
   {{map.html}}{{map.js}}

    <script type="text/javascript">
  function ConfirmDelete() {
      return confirm('Esta seguro que desea eliminar este centro?')
    }
  </script>
    <div class="card-body d-flex flex-wrap justify-content-end">
      <a href="/centros" class="btn btn-secondary  mt-2 ">Volver</a>

      <form action="{{ url_for('centro_update', centro_id = centro.id ) }}"  >
        <button type="submit" class="btn btn-warning mt-2 ml-2">Editar</button>
      </form>

      <form action="{{ url_for('centro_delete') }}" method="POST" enctype="multipart/form-data">
        <input type="hidden" id="centro_id" name="centro_id" value="{{centro.id}}">
        <button type="submite" class="btn btn-danger mt-2 ml-2"  onclick="return ConfirmDelete()" >eliminar</button>
      </form>

      <script>
        var app = new Vue({
          el: '#app',
          delimiters: ["[[", "]]"],
          data: {
            municipios: []
          },
          created() {
            fetch('https://api-referencias.proyecto2020.linti.unlp.edu.ar/municipios')
              .then(response => response.json())
              .then(json =>{
                this.municipios = json.data.Town
              })
          }
        })
      </script>


    </div>
  </div>
</div>

{% endblock %}
